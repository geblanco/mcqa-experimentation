name: hyperparam-search
entry_points:
  # Step for model training
  classification:
    parameters:
      train_embeddings_path: string
      eval_embeddings_path: string
      classifier_dir: string
      metrics_dir: string
    command: "python src/etl/embeddings/classify/classification.py
      --data_path {train_embeddings_path}
      --eval_data_path {eval_embeddings_path}
      -o {classifier_dir}
      --metrics_dir {metrics_dir}
      --train --eval"
  classifier_corrects_model:
    parameters:
      classifier_dir: string
      embeddings_path: string
      output_dir: string
      dataset: string
      split: string
      strategy: string
      no_answer_text: string
    command: "python src/etl/embeddings/transform/correct_predictions.py
      -c {classifier_dir}
      -e {embeddings_path}
      -o {output_dir}
      -d {dataset}
      -s {split}
      --strategy {strategy}
      --no_answer_text {no_answer_text}"
  # Add utility function
  evaluate_corrections:
    parameters:
      dataset: string
      nbest_predictions: string
      output: string
      split: string
      utility_function: string
      task: {type: string, default: "generic"}
    command: "mcqa_utils
      -d {dataset}
      -n {nbest_predictions}
      -s {split}
      --task {task}
      -o {output}
      -m C_at_1 avg
      -ufs {utility_function}
      --overwrite"
  evaluate_model:
    parameters:
      dataset: string
      nbest_predictions: string
      output: string
      split: string
      utility_function: string
      task: {type: string, default: "generic"}
    command: "mcqa_utils
      -d {dataset}
      -n {nbest_predictions}
      -s {split}
      --task {task}
      -o {output}
      -m C_at_1 avg
      -ufs {utility_function}
      --overwrite
      --save_mlflow"
  main:
    parameters:
      classifier_dir: string
      dataset: string
      params_file: string
      classification_train_embeddings_path: string
      classification_eval_embeddings_path: string
      classification_metrics_dir: string
      corrections_embeddings_path: string
      corrections_output_dir: string
      corrections_split: string
      corrections_strategy: string
      corrections_no_answer_text: string
      evaluation_nbest_predictions: string
      evaluation_split: string
      evaluation_output: string
      evaluation_task: string
      evaluation_model_nbest_predictions: string
      evaluation_model_output: string
      evaluation_utility_function: string
    command: "python src/processing/search.py
      --classifier_dir {classifier_dir}
      --dataset {dataset}
      --params_file {params_file}
      --classification_train_embeddings_path {classification_train_embeddings_path}
      --classification_eval_embeddings_path {classification_eval_embeddings_path}
      --classification_metrics_dir {classification_metrics_dir}
      --corrections_embeddings_path {corrections_embeddings_path}
      --corrections_output_dir {corrections_output_dir}
      --corrections_split {corrections_split}
      --corrections_strategy {corrections_strategy}
      --corrections_no_answer_text {corrections_no_answer_text}
      --evaluation_nbest_predictions {evaluation_nbest_predictions}
      --evaluation_split {evaluation_split}
      --evaluation_output {evaluation_output}
      --evaluation_task {evaluation_task}
      --evaluation_model_nbest_predictions {evaluation_model_nbest_predictions}
      --evaluation_model_output {evaluation_model_output}
      --evaluation_utility_function {evaluation_utility_function}"
